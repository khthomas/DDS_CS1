111---
title: "MSDS6306 Case Study 1"
author: "Joe Schueder"
date: "October 6, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(kableExtra)
library(maps)
```
####Market for New Craft Brewery Market in the United States.

#####Prepared by Joe Scheder and Kyle Thomas for New Brewery Inc.

New Brewery Inc. would like to inroduce a new IPA with a high alochol content and bitterness. They would like to intoduce this to a large market that currently favors having breweries producing beers with these characteristics. 

The primary goal of this analysis was to understand the craft brewery market in the United States. There were additional sub goals including:

a. Merging two datasets so that linked beer production with brewery location to find the median International Biterness Unit (IBU) content of beers on a state by state basis. Find the median Alochol Content By Volumne (ABV) of beers on a state by state basis.
b. Generate visualizations so that this data can be quickly and easily understood.
 * Determine which state had the strongest beer (highest IBU)
 * Determine which state had the most bitter beer (highest ABV) 
 * Determine if there is a relationship between bitterness and alcohol content.

The analysis is shown below.  

```{r data import, include=TRUE}
getwd()
setwd ("C:\\Users\\kthomas\\Documents\\SMU\\DDS_CS1\\Data")
beers <- read.csv(file = "Beers.csv", sep=",", header=TRUE)
breweries <- read.csv(file = "Breweries.csv", sep=",", header=TRUE)

#Bring in additional population data. Via Us Cencus (https://www.census.gov/data/tables/2016/demo/popest/state-total.html)
uspop = read.csv("uspop.csv")
colnames(uspop) = c("State_Name", "State", "pop2016")

#head(beers)
kable(head(beers), "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")

#head(breweries)
kable(head(breweries), "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
``` 

The number of breweries are present in each state

```{r summarize by state}
library(plyr)
Statesum <- count(breweries, 'State')
Statesum <- Statesum[order(-Statesum$freq),]
colnames(Statesum) <- c("State", "Number of Breweries")
kable(Statesum, "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")

```

Data integrity checks were done. See the first 6 observations and the last six observations of the data.

```{r mege}
colnames(breweries)[1] <- "Brewery_id"
beerandbrew <- merge(breweries, beers, by=c("Brewery_id"), all= FALSE)
colnames(beerandbrew)[2] <- "Brewery"
colnames(beerandbrew)[5] <- "Beer"

#head(beerandbrew)

kable(head(beerandbrew), "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
#tail(beerandbrew)
kable(tail(beerandbrew), "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Additonal check of data were complete to make sure that data was present for most of the data being analyzed.  The number of blanks in each column is shown.
```{r NACheck}
#colSums(is.na(beerandbrew))
kable(colSums(is.na(beerandbrew)), "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")


```

In order to find the right market for the new beer.  The median alcohol content and international bitterness unit was computed for each state. Data is visulized in bar charts.

```{r abvandibu}
library("reshape2")
abvandibu <- aggregate(beerandbrew[, 7:8], list(beerandbrew$State), median, na.rm=TRUE)
abvandibu$ABV = abvandibu$ABV*100

abvandibumelt <- melt(abvandibu, id=c("Group.1"))
abvandibumelt <-abvandibumelt[order(-abvandibumelt$variable),]
colnames(abvandibumelt) <- c("State", "ABVIBU", "Value")

ABVMED <- abvandibumelt[abvandibumelt$ABVIBU == "ABV", ]
IBUMED <- abvandibumelt[abvandibumelt$ABVIBU == "IBU", ]

library("ggplot2")
qplot(x=State, data=ABVMED, geom ="bar", weight = Value, fill = Value, ylab = 'Median ABV') + coord_flip()

qplot(x=State, data=IBUMED, geom ="bar", weight=Value, fill = Value, ylab = 'IBU Median') + coord_flip()
                      
```

The state that has the maximum alcoholic (ABV) beer:

```{r getmax}
maxabv <- beerandbrew[which.max(beerandbrew$ABV),]
#maxabv$State
kable(maxabv$State, "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```


The state that has the most bitter (IBU) beer:

```{r getmax2}
 maxibu <- beerandbrew[which.max(beerandbrew$IBU),]
#maxibu$State
kable(maxibu$State, "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Finally a summary statistics table for the ABV variable.
```{R summarystatsabv}
sumtable <- summary(beerandbrew$ABV)
Statistics <- c("Min.", "1st Qu.",  "Median", "Mean", "3rd Qu.", "Max.", "NA's" )
Values <- c(sumtable[1], sumtable[2],  sumtable[3], sumtable[4], sumtable[5], sumtable[6], sumtable[7] )
sumdf <- data.frame(Statistics, Values)
kable(sumdf[2], "html", padding = 2, longtable = TRUE) %>%
kable_styling(bootstrap_options = "striped", full_width = F, position = "left")
```

Shown now is the apparent relationship between the bitterness of the beer and its alcoholic content.
```{r scatter}
#Changed old scatter plot to ggplot
# scatter.smooth(beerandbrew$ABV, beerandbrew$IBU, ylab = "IBU",
#                xlab = "ABV", col= 4, main = "ABV vs IBU")


ggScatter = ( ggplot(beerandbrew, aes(x=IBU, y=ABV)) + geom_point() + 
                labs(title="IBU Plotted Against ABV") + theme(plot.title = element_text(hjust = 0.5)) +
                geom_smooth())

ggScatter
```

Based on the analyis of the data for breweries by state, there is reason to believe that states that there are certain states that have both high median alcohol content and bitter beers.  These states pimarily; A,B,C,D, E would be good states to intoduce the new beer.


A basic market analysis will be conducted to determine which states could use a high ABV and high IBU beer. This will be done by first identifying the 10 states with the lowest median IBU and ABV beers. Then the top three states will be presented based on state population.

```{r bestStates}
#Merge us population with main dataframe

beerandbrew = merge(beerandbrew, uspop, by = "State")

#We need a way to compare IBU and ABV at the same time. This can be done by simply multiplying together 
#IBU and ABV to make a combined measure. 

colnames(abvandibu) = c("State", "ABV", "IBU")

needBeer = merge(abvandibu, uspop, by="State")
needBeer["combined"]= needBeer$IBU*needBeer$ABV

mostneeded = head(needBeer[order(needBeer$combined),],10)

needAndPop = tail(mostneeded[order(mostneeded$pop2016),],3)

needAndPop
```

```{r stateVis}
beerandbrew$State_Name = tolower(beerandbrew$State_Name)
beerandbrew$State_Name = sub(".","", beerandbrew$State_Name)
colnames(beerandbrew)[11] = "region"

stateMap = map_data("state")
mapdf = merge(stateMap, beerandbrew, by="region")
mapdf["combined"] = mapdf$ABV*mapdf$IBU
mapdf = mapdf[order(mapdf$order),]

#Right now this is IBU, I will change it to what ever metrix we want to evaluate target states.
#Thanks stackhub
ggplot(mapdf, aes(x=long,y=lat,group=group))+
  geom_polygon(aes(fill=IBU))+
  geom_path()+ 
  scale_fill_gradientn(colours=rev(heat.colors(10)),na.value="grey90")+
  coord_map()

```























